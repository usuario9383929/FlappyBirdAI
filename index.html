<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Flappy Bird - Deep Q-Learning</title>
<style>
body {
  margin: 0;
  background: #222;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

#game {
  position: relative;
  width: min(98vw, 900px);
  height: min(98vh, 700px);
  overflow: hidden;
  border-radius: 12px;
  background: linear-gradient(#70c5ce, #c0f0ff);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

#info-panel {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 13px;
  z-index: 100;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255,255,255,0.1);
}

.control-btn {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  padding: 5px 10px;
  margin: 2px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  transition: background 0.2s;
}

.control-btn:hover {
  background: rgba(255,255,255,0.3);
}

#epsilon-bar {
  width: 100%;
  height: 4px;
  background: rgba(255,255,255,0.1);
  margin-top: 5px;
  border-radius: 2px;
  overflow: hidden;
}

#epsilon-fill {
  height: 100%;
  background: linear-gradient(90deg, #ff5252, #ffeb3b, #4caf50);
  width: 100%;
  transition: width 0.3s;
}
</style>
</head>
<body>

<div id="game"></div>

<div id="info-panel">
  <div><strong>Flappy Bird - DQN AI</strong></div>
  <div>ε: <span id="epsilon-value">1.000</span> | Score: <span id="score-value">0</span></div>
  <div>High Score: <span id="high-score-value">0</span></div>
  <div id="epsilon-bar">
    <div id="epsilon-fill"></div>
  </div>
  <div style="margin-top: 8px;">
    <button class="control-btn" onclick="window.toggleAutoRestart()">Auto-Restart</button>
    <button class="control-btn" onclick="location.reload()">Reset AI</button>
  </div>
  <div style="font-size: 11px; opacity: 0.7; margin-top: 5px;">
    Espaço: Pulo manual | R: Reiniciar
  </div>
</div>

<script type="module">
import { renderMapa } from "./mapa.js";
import { createPipes } from "./pipes.js";
import { renderFlappy, birdState, jump } from "./flappy.js";
import { startGameLoop } from "./logic.js";

const game = document.getElementById("game");

// Renderizar tudo
renderMapa(game);
createPipes(game);
renderFlappy(game);
startGameLoop(game);

// Controles
document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    jump();
    e.preventDefault();
  }
  if (e.code === "KeyR") {
    location.reload();
  }
  if (e.code === "KeyA") {
    window.toggleAutoRestart();
  }
});

// Atualizar UI
function updateUI() {
  const epsilonValue = document.getElementById("epsilon-value");
  const epsilonFill = document.getElementById("epsilon-fill");
  const scoreValue = document.getElementById("score-value");
  const highScoreValue = document.getElementById("high-score-value");
  
  if (epsilonValue && window.epsilon !== undefined) {
    epsilonValue.textContent = window.epsilon.toFixed(3);
  }
  
  if (epsilonFill && window.epsilon !== undefined) {
    const percent = (1 - window.epsilon) * 100;
    epsilonFill.style.width = `${percent}%`;
  }
  
  // Atualizar score via intervalo
  if (scoreValue) {
    const gameDiv = document.getElementById("score-display");
    if (gameDiv) {
      scoreValue.textContent = gameDiv.textContent || "0";
    }
  }
  
  if (highScoreValue) {
    const hsDiv = document.getElementById("high-score-display");
    if (hsDiv) {
      const match = hsDiv.textContent.match(/\d+/);
      highScoreValue.textContent = match ? match[0] : "0";
    }
  }
}

setInterval(updateUI, 100);
</script>

</body>
</html>